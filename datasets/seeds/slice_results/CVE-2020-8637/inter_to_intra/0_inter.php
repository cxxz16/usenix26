<?php
function merged_change_parent_flow()
{
    // Convert class members into local/global variables
    global $db, $object_table;

    // Source: $_REQUEST
    $doAction = isset($_REQUEST['doAction']) ? $_REQUEST['doAction'] : null;

    switch ($doAction) {
        case 'changeParent':
            $node_id = isset($_REQUEST['nodeid']) ? $_REQUEST['nodeid'] : null;
            $parent_id = isset($_REQUEST['newparentid']) ? $_REQUEST['newparentid'] : null;

            $debugMsg = 'Class:tree - Method:change_parent :: ';

            if (is_array($node_id)) {
                $id_list = implode(",", $node_id);
                $where_clause = " WHERE id IN ($id_list) ";
            } else {
                $where_clause = " WHERE id = {$node_id}";
            }

            $sql = "/* $debugMsg */ UPDATE {$object_table} " .
                   " SET parent_id = " . $db->prepare_int($parent_id) . " {$where_clause}";

            // Sink: keep the call as-is
            $result = $db->exec_query($sql);
            break;

        default:
            break;
    }
}
?>