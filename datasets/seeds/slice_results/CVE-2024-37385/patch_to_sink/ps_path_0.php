// File: program/lib/Roundcube/rcube.php

    public static function exec($cmd, ...$args)
    {
        preg_match_all('/({(-?)([a-z]\w*)})/', $cmd, $matches, PREG_SET_ORDER);
        $cmd = strtr($cmd, $replacements);
        return (string) shell_exec($cmd);
    }


// File: program/lib/Roundcube/rcube_image.php

    public function resize($size, $filename = null, $browser_compat = false)
    {
        $convert = self::getCommand('im_convert_path');
        if ($convert || class_exists('Imagick', false)) {
            if ($scale >= 1 && $p['intype'] == $type) {
            }
            else {
                if (in_array($type, explode(',', $valid_types))) { // Valid type?
                    if ($scale >= 1) {
                    }
                    else {
                    }
                    if ($convert) {
                        $result = rcube::exec($convert
                            . ' 2>&1 -flatten -auto-orient -colorspace sRGB -strip'
                            . ' -quality {quality} -resize {size} {intype}:{in} {type}:{out}', $p);
                    }
                    else {
                    }
                }
            }
            if ($result === '') {
            }
        }
        if ($props['gd_type'] && $props['width'] > 0 && $props['height'] > 0) {
            if ($result) {
            }
        }
    }


    private static function getCommand($opt_name)
    {
        $cmd = rcube::get_instance()->config->get($opt_name);
        if (empty($cmd)) {
        }
        if (preg_match('/^(convert|identify)(\.exe)?$/i', $cmd)) {
            return $cmd;
        }
        if ($cmd[0] != "\\" && file_exists($cmd)) {
            return $cmd;
        }
        if (empty($error[$opt_name])) {
            rcube::raise_error("Invalid $opt_name: $cmd", true, false);
            $error[$opt_name] = true;
        }
    }

