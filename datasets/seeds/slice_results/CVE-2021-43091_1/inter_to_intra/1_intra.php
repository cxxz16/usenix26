<?php
function listpages($sort, $user) {
    $tree = GetParameter('tree');
    $owner = GetParameter('owner');
    if ($owner == 'owner') {
        $owner = GetPageOwner();
    }
    if (($owner && $sort == 'owner') || ($user && $sort == 'user')) {
    }
    if ($tree == 'tree') {
        if ($owner) {
            $tree = $owner;
        } else {
            $tree = GetConfigValue('root_page');
        }
    }
    $prefix = GetConfigValue('table_prefix');
    if ($tree) {
        switch ($sort) {
            case 'owner':
                $sql = 'SELECT a.owner, b.tag IS NOT NULL owner_has_ownpage'
                    . ' FROM ' . $prefix . 'pages a'
                    . ' LEFT JOIN ' . $prefix . 'pages b ON a.owner = b.tag AND b.latest = "Y"';
                break;
            case 'user':
                $sql = 'SELECT a.user, u.name IS NOT NULL user_is_registered, b.tag IS NOT NULL user_has_ownpage'
                    . ' FROM ' . $prefix . 'pages a'
                    . ' LEFT JOIN ' . $prefix . 'users u ON a.user = u.name'
                    . ' LEFT JOIN ' . $prefix . 'pages b ON u.name = b.tag AND b.latest = "Y"';
                break;
            case 'time':
                $sql = 'SELECT a.time'
                    . ' FROM ' . $prefix . 'pages a';
                break;
            case 'tag':
                $links[$tree] = array();
        } // switch
        if ($sort != 'tag') {
            $sql .= ' WHERE a.tag = "' . AddSlashes($tree) . '" AND a.latest = "Y" LIMIT 1';
            if (!$rootData = LoadSingle($sql)) {
            }
        }
    } else {
    }
}
?>