<?php
function merged_function() {
  global $page, $display_formats, $formats_original_info;

  // Combined logic from admin/photo.php and admin/picture_modify.php
  if (!isset($page['image']) || isset($_POST['submit'])) {
    $image_id = $_GET['image_id'];
    if (!is_numeric($image_id)) {
      fatal_error('[get_image_infos] invalid image identifier ' . htmlentities($image_id));
    }
    $query = '
SELECT *
  FROM ' . IMAGES_TABLE . '
  WHERE id = ' . $image_id . '
;';
    $images = query2array($query);
    if (count($images) == 0) {
      // die_on_missing is true in these contexts
      fatal_error("photo " . $image_id . " does not exist");
    }
    $page['image'] = $images[0];
  }

  // Logic from admin/photos_add_direct.php
  if ($display_formats && $_GET['formats']) {
    $formats = $_GET['formats'];
    if (!is_numeric($formats)) {
      fatal_error('[get_image_infos] invalid image identifier ' . htmlentities($formats));
    }
    $query_f = '
SELECT *
  FROM ' . IMAGES_TABLE . '
  WHERE id = ' . $formats . '
;';
    $images_f = query2array($query_f);
    if (count($images_f) > 0) {
      $formats_original_info = $images_f[0];
    }
    // If no result and die_on_missing=false, do nothing (no fatal_error)
  }
}